# Milestone v1.1: AI Diagram Experience

**Status:** SHIPPED 2026-01-11
**Phases:** 13-20
**Total Plans:** 9 (8 main + 1 fix)

## Overview

Improve AI diagram generation with Mermaid skill rules, proper markdown rendering, ASCII sidecar support, and render fallbacks. Complete the AI-assisted diagram creation experience.

## Phases

### Phase 13: Mermaid Skill Prompt

**Goal**: Inject the Mermaid Diagrams Skill into AI system prompts so AI follows compatibility rules and generates sidecars
**Depends on**: Previous milestone complete
**Plans**: 1 plan

Plans:
- [x] 13-01: Update buildSystemPrompt with Mermaid skill

**Details:**
Updated `src/services/ai/base.ts` buildSystemPrompt() with comprehensive Mermaid skill rules including compatibility guidelines, ASCII sidecar requirements, and diagram type guidance.

### Phase 14: Markdown Rendering

**Goal**: Properly render markdown in AI chat responses (headers, code blocks, lists, etc.)
**Depends on**: Phase 13
**Plans**: 2 plans

Plans:
- [x] 14-01: Install deps + create MarkdownRenderer component
- [x] 14-02: Integrate into ChatMessage + add styles

**Details:**
Installed marked@17 and highlight.js@11. Created MarkdownRenderer.vue with custom renderer for syntax highlighting. Integrated into ChatMessage for assistant messages.

### Phase 15: Sidecar Detection

**Goal**: Parse and extract ASCII sidecar code blocks from AI responses
**Depends on**: Phase 14
**Plans**: 1 plan

Plans:
- [x] 15-01: Add DiagramBlock types + parser utility

**Details:**
Created DiagramBlock and SidecarBlock types in chat.ts. Created parseDiagramBlocks() and hasDiagramBlocks() utilities in diagramParser.ts.

### Phase 16: Sidecar Display

**Goal**: Display ASCII sidecar alongside Mermaid diagrams in chat UI with toggle
**Depends on**: Phase 15
**Plans**: 1 plan

Plans:
- [x] 16-01: DiagramBlockRenderer + MessageContent components

**Details:**
Created DiagramBlockRenderer with three view modes (Diagram/ASCII/Code). Created MessageContent for mixed text/diagram content. Updated ChatMessage to use MessageContent.

### Phase 17: Template Library

**Goal**: Store compatible Mermaid templates with quick insertion UI in chat
**Depends on**: Phase 13
**Plans**: 1 plan + 1 fix

Plans:
- [x] 17-01: Template types, data, and TemplateLibrary component
- [x] 17-01-FIX: Modal positioning and Journey template fixes

**Details:**
Created 12 templates (5 basic, 3 advanced, 4 fallbacks) with TemplateLibrary component. Fixed modal positioning and Journey template syntax issues.

### Phase 18: Diagram Type Assistant

**Goal**: Help users choose appropriate diagram type based on their intent
**Depends on**: Phase 17
**Plans**: 1 plan

Plans:
- [x] 18-01: Verify auto-detection and add visual feedback

**Details:**
Verified auto-detection works for all 11 diagram types. Added visual feedback animation to toolbar badge on type change.

### Phase 19: Render Fallback

**Goal**: Automatically show ASCII sidecar when Mermaid rendering fails
**Depends on**: Phase 16
**Plans**: 1 plan

Plans:
- [x] 19-01: Auto-fallback and improved error UX

**Details:**
Added auto-switch to ASCII on render failure. Added fallback notice and improved error display with actionable guidance.

### Phase 20: Polish

**Goal**: Error handling, loading states, UX refinements for the entire AI diagram experience
**Depends on**: All previous phases
**Plans**: 1 plan

Plans:
- [x] 20-01: Connecting state, tooltips, debounced scroll

**Details:**
Added "Connecting to AI..." state before streaming. Added explanatory tooltips to token stats and truncation warnings. Debounced scroll during streaming for smooth performance.

---

## Milestone Summary

**Key Decisions:**

- Mermaid skill in system prompt (AI learns rules without code changes)
- Three-view toggle for each diagram (Diagram/ASCII/Code)
- Auto-fallback to ASCII on render failure (graceful degradation)
- 100ms debounced scroll during streaming (smooth performance)
- Template categories: basic, advanced, fallback

**Issues Resolved:**

- Modal positioning fixed (absolute â†’ fixed)
- Journey diagram type added to validator
- Template syntax compatibility issues fixed

**Issues Deferred:**

None

**Technical Debt Incurred:**

None - clean implementation

---

_For current project status, see .planning/ROADMAP.md_
