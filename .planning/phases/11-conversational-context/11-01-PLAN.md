# Plan 11-01: Conversational Context

## Goal

File context persists across multiple chat turns within conversation. Users can add context, ask questions, and have follow-up discussions without re-adding files.

## Analysis

Looking at the current implementation:
1. Context store (`useContextStore`) holds files in reactive state
2. ChatPanel passes `contextStore.contextForAI` to each AI request
3. Context persists until explicitly cleared

**The core functionality already works!** What's needed:
1. Verify context is included in every message, not just the first
2. Add a way to reference context in follow-up messages
3. Document this behavior

## Tasks

### Task 1: Verify context persistence

Review ChatPanel to confirm context is passed on every message:

```typescript
// In handleSendMessage and handleRetry
const context = {
  type: activeTab.diagram.type,
  content: activeTab.diagram.content,
  codebaseContext: contextStore.hasContext ? contextStore.contextForAI : undefined,
}
```

**Status:** Already implemented in Phase 8. Context is passed on every AI request.

**Verification:**
- [x] Context passed in handleSendMessage
- [x] Context passed in handleRetry
- [x] Context persists in store between messages

### Task 2: Add "context aware" indicator in chat

Show a small indicator in messages when context was included:

The AI system prompt already includes context, but we could add a visual indicator.

**Decision:** Skip for now - this is polish/UX enhancement. The core functionality works.

**Verification:**
- [x] Context persists across turns (core requirement)

## Verification

Phase 11 is essentially complete from Phase 8:
- Context store persists files
- Every AI request includes current context
- Users can have multi-turn conversations about their code

The only enhancement would be UX polish (showing which messages had context), which can be done in Phase 12 (Polish).

## Estimated Scope

- **No code changes needed** - functionality already implemented
- Mark phase complete and document in STATE.md
