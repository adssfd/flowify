---
phase: 18-diagram-type-assistant
plan: 01
type: execute
---

<objective>
Verify and polish the diagram type auto-detection when AI generates diagrams.

Purpose: The core auto-detection already exists in `updateTabContent()` → `detectDiagramType()`. This phase verifies it works correctly and adds subtle UX polish.
Output: Confirmed auto-detection for all 11 diagram types, optional visual feedback.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Phase context (from /gsd:discuss-phase):**
@.planning/phases/18-diagram-type-assistant/18-CONTEXT.md

**Prior phase (diagram rendering in chat):**
@.planning/phases/16-sidecar-display/16-01-SUMMARY.md

**Key files:**
@src/stores/tabs.ts - updateTabContent() already calls detectDiagramType()
@src/utils/mermaid/validator.ts - detectDiagramType() maps mermaid content to DiagramType
@src/components/chat/ChatPanel.vue - handleApplySuggestion() calls updateTabContent()
@src/components/toolbar/AppToolbar.vue - Shows reactive diagram type badge

**Existing auto-detection flow:**
1. AI generates mermaid code block
2. User clicks "Apply Suggestion"
3. `handleApplySuggestion(content)` in ChatPanel
4. `tabsStore.updateTabContent(tabId, content)` in tabs store
5. `detectDiagramType(content)` runs (lines 207-211 in tabs.ts)
6. If detected type differs, tab.diagram.type is updated
7. Toolbar badge updates reactively

**Discovery:** The feature is already implemented. This phase verifies it works and adds polish.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify auto-detection works for all diagram types</name>
  <files>src/utils/mermaid/validator.ts</files>
  <action>
Write a quick verification that detectDiagramType() correctly maps all 11 mermaid syntaxes to DiagramType enum values.

Run these checks in the browser console or create a simple test:
- classDiagram → DiagramType.CLASS
- sequenceDiagram → DiagramType.SEQUENCE
- flowchart → DiagramType.FLOWCHART
- graph → DiagramType.FLOWCHART (alias)
- stateDiagram-v2 → DiagramType.STATE
- erDiagram → DiagramType.ER
- gantt → DiagramType.GANTT
- pie → DiagramType.PIE
- mindmap → DiagramType.MINDMAP
- timeline → DiagramType.TIMELINE
- gitGraph → DiagramType.GITGRAPH
- journey → DiagramType.JOURNEY

If any mapping is broken, fix it.
  </action>
  <verify>All 11 diagram types detected correctly from mermaid content</verify>
  <done>detectDiagramType() works for all supported diagram types</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Verified auto-detection implementation</what-built>
  <how-to-verify>
1. Run: npm run dev
2. In the chat, ask AI to generate a sequence diagram (e.g., "Create a sequence diagram for user login")
3. When AI responds with mermaid code, click "Apply Suggestion"
4. Verify: Toolbar badge changes to "Sequence Diagram"
5. Repeat with a different type: Ask AI for an ER diagram
6. Verify: Toolbar badge changes to "ER Diagram"
7. Confirm no extra clicks or confirmations needed
  </how-to-verify>
  <resume-signal>Type "approved" if auto-detection works seamlessly, or describe any issues</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Add subtle visual feedback on type change (optional polish)</name>
  <files>src/components/toolbar/AppToolbar.vue</files>
  <action>
Add a brief highlight animation to the diagram type badge when it changes.

In AppToolbar.vue:
1. Add a computed or ref to track when type changes
2. Add a CSS class that briefly highlights the badge (e.g., background pulse)
3. Use Vue's transition or a brief timeout to remove the highlight

CSS approach:
```css
.diagram-type-badge.type-changed {
  animation: type-pulse 0.5s ease-out;
}

@keyframes type-pulse {
  0% { background-color: var(--color-primary); color: white; }
  100% { background-color: var(--color-surface-elevated); color: var(--color-text-secondary); }
}
```

Keep it subtle - this is optional polish. If complex to implement cleanly, skip it.
  </action>
  <verify>Badge briefly highlights when diagram type changes (or no change if deemed unnecessary)</verify>
  <done>Visual feedback added for type changes OR explicitly skipped as unnecessary</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run type-check` passes
- [ ] `npm run build` succeeds
- [ ] Auto-detection works when applying AI suggestions
- [ ] Toolbar badge updates correctly
- [ ] Experience feels "seamless" per CONTEXT.md vision
</verification>

<success_criteria>
- detectDiagramType() verified for all 11 diagram types
- Apply Suggestion → auto type switch → toolbar update works end-to-end
- No user prompts or confirmations required
- Type check and build pass
</success_criteria>

<output>
After completion, create `.planning/phases/18-diagram-type-assistant/18-01-SUMMARY.md`
</output>
