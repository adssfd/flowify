---
phase: 17-template-library
plan: 01
type: execute
---

<objective>
Create a template library with renderer-compatible Mermaid templates and quick insertion UI.

Purpose: Users can quickly insert working diagram templates instead of writing from scratch
Output: DiagramTemplate types, template data, TemplateLibrary component integrated into chat
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-sidecar-display/16-01-SUMMARY.md
@.planning/references/mermaid-skill.md

**Source files:**
@src/components/chat/ChatInput.vue
@src/components/chat/ChatPanel.vue
@src/types/diagram.ts
@src/utils/mermaid/templates.ts

**Tech stack available:**
- TypeScript 5.9.3
- Vue 3.5.26

**Established patterns:**
- Components use `<script setup lang="ts">`
- CSS variables for theming
- Types in src/types/ with barrel exports
- Suggestion chips in ChatInput emit events to parent

**Constraining decisions:**
- Phase 13: Mermaid skill defines 12 renderer-compatible templates
- Templates must work on older renderers (VS Code, Git platforms)
- Use `graph` instead of `flowchart` keyword for compatibility
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create template types and data</name>
  <files>src/types/templates.ts, src/types/index.ts, src/data/diagramTemplates.ts</files>
  <action>
1. Create src/types/templates.ts with DiagramTemplate interface:

```typescript
export interface DiagramTemplate {
  id: string
  name: string
  description: string
  category: 'basic' | 'advanced' | 'fallback'
  diagramType: string // 'flowchart', 'sequence', etc.
  code: string // The mermaid code
  icon?: string // Optional emoji icon
}
```

2. Add export to src/types/index.ts:
```typescript
export * from './templates'
```

3. Create src/data/diagramTemplates.ts with all 12 templates from mermaid-skill.md:
- Flowchart (basic) - graph LR with decision
- Sequence (basic) - with autonumber and participants
- Class (basic) - with methods and relationships
- State (basic) - stateDiagram-v2 with nested states
- ER (basic) - with entities and relationships
- Journey (advanced) - user journey with sections
- Gantt (advanced) - with tasks and milestones
- Pie (advanced) - simple pie chart
- Quadrant fallback - graph TB grid
- Requirement fallback - graph LR traceability
- Sankey fallback - graph LR with weights
- Git graph fallback - graph LR DAG

Each template should have:
- Unique id (e.g., 'flowchart-basic')
- Descriptive name (e.g., 'Flowchart with Decision')
- Short description
- Category
- diagramType matching existing DiagramType enum values where possible
- The actual mermaid code from mermaid-skill.md
  </action>
  <verify>npm run type-check passes</verify>
  <done>DiagramTemplate type defined, 12 templates exported from src/data/diagramTemplates.ts</done>
</task>

<task type="auto">
  <name>Task 2: Create TemplateLibrary component</name>
  <files>src/components/chat/TemplateLibrary.vue</files>
  <action>
Create a dropdown/popover component that displays template categories and allows selection:

```vue
<script setup lang="ts">
import { ref, computed } from 'vue'
import type { DiagramTemplate } from '@/types'
import { diagramTemplates } from '@/data/diagramTemplates'

const emit = defineEmits<{
  select: [template: DiagramTemplate]
  close: []
}>()

const selectedCategory = ref<string | null>(null)

const categories = computed(() => {
  const cats = new Map<string, DiagramTemplate[]>()
  for (const t of diagramTemplates) {
    const existing = cats.get(t.category) || []
    existing.push(t)
    cats.set(t.category, existing)
  }
  return cats
})

const filteredTemplates = computed(() => {
  if (!selectedCategory.value) return diagramTemplates
  return diagramTemplates.filter(t => t.category === selectedCategory.value)
})

function selectTemplate(template: DiagramTemplate) {
  emit('select', template)
  emit('close')
}
</script>
```

Template structure:
- Category tabs/filters at top (Basic, Advanced, Fallbacks)
- Grid or list of templates with name, icon, description
- Click to select and emit
- Styled with CSS variables for theme compatibility

Keep it compact since it appears above chat input.
  </action>
  <verify>npm run type-check passes</verify>
  <done>TemplateLibrary component created with category filtering and template selection</done>
</task>

<task type="auto">
  <name>Task 3: Integrate into ChatInput</name>
  <files>src/components/chat/ChatInput.vue</files>
  <action>
1. Add template library toggle and component:

```typescript
import TemplateLibrary from './TemplateLibrary.vue'
import type { DiagramTemplate } from '@/types'

const showTemplateLibrary = ref(false)

// Add new emit
interface Emits {
  // ... existing emits
  (e: 'template-selected', template: DiagramTemplate): void
}

function handleTemplateSelect(template: DiagramTemplate) {
  emit('template-selected', template)
  showTemplateLibrary.value = false
}
```

2. Add template button next to suggestion chips:

```vue
<button
  class="template-button"
  @click="showTemplateLibrary = !showTemplateLibrary"
  title="Insert diagram template"
>
  ðŸ“‹ Templates
</button>
```

3. Add TemplateLibrary component (conditionally rendered):

```vue
<TemplateLibrary
  v-if="showTemplateLibrary"
  @select="handleTemplateSelect"
  @close="showTemplateLibrary = false"
/>
```

4. Update ChatPanel.vue to handle the template-selected event:
- Add handler that applies template code to the active tab's editor
  </action>
  <verify>npm run type-check && npm run build passes</verify>
  <done>Template button in ChatInput, TemplateLibrary opens on click, selection applies to editor</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run type-check` passes
- [ ] `npm run build` succeeds
- [ ] DiagramTemplate type defined with all fields
- [ ] 12 renderer-compatible templates in diagramTemplates.ts
- [ ] TemplateLibrary component shows categories and templates
- [ ] Template selection emits event with template data
- [ ] ChatInput has template button
- [ ] ChatPanel handles template selection (applies to editor)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors introduced
- Users can browse and select from 12 diagram templates
- Selected template code applies to the active editor
- Phase 17 complete
</success_criteria>

<output>
After completion, create `.planning/phases/17-template-library/17-01-SUMMARY.md`
</output>
